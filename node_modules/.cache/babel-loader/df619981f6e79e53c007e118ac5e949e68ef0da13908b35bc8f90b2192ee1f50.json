{"ast":null,"code":"\"use strict\";\n\n/**\n * @license\n * Copyright 2019 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.cropTensor = exports.capture = void 0;\nvar tf = require(\"@tensorflow/tfjs\");\n/**\n * Receives an image and normalizes it between -1 and 1.\n * Returns a batched image (1 - element batch) of shape [1, w, h, c]\n * @param rasterElement the element with pixels to convert to a Tensor\n * @param grayscale optinal flag that changes the crop to [1, w, h, 1]\n */\nfunction capture(rasterElement, grayscale) {\n  return tf.tidy(function () {\n    var pixels = tf.browser.fromPixels(rasterElement);\n    // crop the image so we're using the center square\n    var cropped = cropTensor(pixels, grayscale);\n    // Expand the outer most dimension so we have a batch size of 1\n    var batchedImage = cropped.expandDims(0);\n    // Normalize the image between -1 and a1. The image comes in between 0-255\n    // so we divide by 127 and subtract 1.\n    return batchedImage.toFloat().div(tf.scalar(127)).sub(tf.scalar(1));\n  });\n}\nexports.capture = capture;\nfunction cropTensor(img, grayscaleModel, grayscaleInput) {\n  var size = Math.min(img.shape[0], img.shape[1]);\n  var centerHeight = img.shape[0] / 2;\n  var beginHeight = centerHeight - size / 2;\n  var centerWidth = img.shape[1] / 2;\n  var beginWidth = centerWidth - size / 2;\n  if (grayscaleModel && !grayscaleInput) {\n    //cropped rgb data\n    var grayscale_cropped = img.slice([beginHeight, beginWidth, 0], [size, size, 3]);\n    grayscale_cropped = grayscale_cropped.reshape([size * size, 1, 3]);\n    var rgb_weights = [0.2989, 0.5870, 0.1140];\n    grayscale_cropped = tf.mul(grayscale_cropped, rgb_weights);\n    grayscale_cropped = grayscale_cropped.reshape([size, size, 3]);\n    grayscale_cropped = tf.sum(grayscale_cropped, -1);\n    grayscale_cropped = tf.expandDims(grayscale_cropped, -1);\n    return grayscale_cropped;\n  }\n  return img.slice([beginHeight, beginWidth, 0], [size, size, 3]);\n}\nexports.cropTensor = cropTensor;","map":{"version":3,"names":["tf","require","capture","rasterElement","grayscale","tidy","pixels","browser","fromPixels","cropped","cropTensor","batchedImage","expandDims","toFloat","div","scalar","sub","exports","img","grayscaleModel","grayscaleInput","size","Math","min","shape","centerHeight","beginHeight","centerWidth","beginWidth","grayscale_cropped","slice","reshape","rgb_weights","mul","sum"],"sources":["C:\\Users\\Chris Littlejohn\\Downloads\\barcode-matcher-final-project (1)\\node_modules\\@teachablemachine\\image\\src\\utils\\tf.ts"],"sourcesContent":["/**\n * @license\n * Copyright 2019 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport * as tf from '@tensorflow/tfjs';\n\n/**\n * Receives an image and normalizes it between -1 and 1.\n * Returns a batched image (1 - element batch) of shape [1, w, h, c]\n * @param rasterElement the element with pixels to convert to a Tensor\n * @param grayscale optinal flag that changes the crop to [1, w, h, 1]\n */\nexport function capture(rasterElement: HTMLImageElement | HTMLVideoElement | HTMLCanvasElement, grayscale?: boolean) {\n    return tf.tidy(() => {\n        const pixels = tf.browser.fromPixels(rasterElement);\n\n        // crop the image so we're using the center square\n        const cropped = cropTensor(pixels, grayscale);\n\n        // Expand the outer most dimension so we have a batch size of 1\n        const batchedImage = cropped.expandDims(0);\n\n        // Normalize the image between -1 and a1. The image comes in between 0-255\n        // so we divide by 127 and subtract 1.\n        return batchedImage.toFloat().div(tf.scalar(127)).sub(tf.scalar(1));\n    });\n}\n\n\nexport function cropTensor( img: tf.Tensor3D, grayscaleModel?: boolean, grayscaleInput?: boolean ) : tf.Tensor3D {\n    const size = Math.min(img.shape[0], img.shape[1]);\n    const centerHeight = img.shape[0] / 2;\n    const beginHeight = centerHeight - (size / 2);\n    const centerWidth = img.shape[1] / 2;\n    const beginWidth = centerWidth - (size / 2);\n    \n    if (grayscaleModel && !grayscaleInput) {\n        //cropped rgb data\n        let grayscale_cropped = img.slice([beginHeight, beginWidth, 0], [size, size, 3]);\n        \n        grayscale_cropped = grayscale_cropped.reshape([size * size, 1, 3])\n        const rgb_weights = [0.2989, 0.5870, 0.1140]\n        grayscale_cropped = tf.mul(grayscale_cropped, rgb_weights)\n        grayscale_cropped = grayscale_cropped.reshape([size, size, 3]);\n    \n        grayscale_cropped = tf.sum(grayscale_cropped, -1)\n        grayscale_cropped = tf.expandDims(grayscale_cropped, -1)\n\n        return grayscale_cropped;\n    }\n    return img.slice([beginHeight, beginWidth, 0], [size, size, 3]);\n}\n"],"mappings":";;AAAA;;;;;;;;;;;;;;;;;;;;AAiBA,IAAAA,EAAA,GAAAC,OAAA;AAEA;;;;;;AAMA,SAAgBC,OAAOA,CAACC,aAAsE,EAAEC,SAAmB;EAC/G,OAAOJ,EAAE,CAACK,IAAI,CAAC;IACX,IAAMC,MAAM,GAAGN,EAAE,CAACO,OAAO,CAACC,UAAU,CAACL,aAAa,CAAC;IAEnD;IACA,IAAMM,OAAO,GAAGC,UAAU,CAACJ,MAAM,EAAEF,SAAS,CAAC;IAE7C;IACA,IAAMO,YAAY,GAAGF,OAAO,CAACG,UAAU,CAAC,CAAC,CAAC;IAE1C;IACA;IACA,OAAOD,YAAY,CAACE,OAAO,EAAE,CAACC,GAAG,CAACd,EAAE,CAACe,MAAM,CAAC,GAAG,CAAC,CAAC,CAACC,GAAG,CAAChB,EAAE,CAACe,MAAM,CAAC,CAAC,CAAC,CAAC;EACvE,CAAC,CAAC;AACN;AAdAE,OAAA,CAAAf,OAAA,GAAAA,OAAA;AAiBA,SAAgBQ,UAAUA,CAAEQ,GAAgB,EAAEC,cAAwB,EAAEC,cAAwB;EAC5F,IAAMC,IAAI,GAAGC,IAAI,CAACC,GAAG,CAACL,GAAG,CAACM,KAAK,CAAC,CAAC,CAAC,EAAEN,GAAG,CAACM,KAAK,CAAC,CAAC,CAAC,CAAC;EACjD,IAAMC,YAAY,GAAGP,GAAG,CAACM,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC;EACrC,IAAME,WAAW,GAAGD,YAAY,GAAIJ,IAAI,GAAG,CAAE;EAC7C,IAAMM,WAAW,GAAGT,GAAG,CAACM,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC;EACpC,IAAMI,UAAU,GAAGD,WAAW,GAAIN,IAAI,GAAG,CAAE;EAE3C,IAAIF,cAAc,IAAI,CAACC,cAAc,EAAE;IACnC;IACA,IAAIS,iBAAiB,GAAGX,GAAG,CAACY,KAAK,CAAC,CAACJ,WAAW,EAAEE,UAAU,EAAE,CAAC,CAAC,EAAE,CAACP,IAAI,EAAEA,IAAI,EAAE,CAAC,CAAC,CAAC;IAEhFQ,iBAAiB,GAAGA,iBAAiB,CAACE,OAAO,CAAC,CAACV,IAAI,GAAGA,IAAI,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;IAClE,IAAMW,WAAW,GAAG,CAAC,MAAM,EAAE,MAAM,EAAE,MAAM,CAAC;IAC5CH,iBAAiB,GAAG7B,EAAE,CAACiC,GAAG,CAACJ,iBAAiB,EAAEG,WAAW,CAAC;IAC1DH,iBAAiB,GAAGA,iBAAiB,CAACE,OAAO,CAAC,CAACV,IAAI,EAAEA,IAAI,EAAE,CAAC,CAAC,CAAC;IAE9DQ,iBAAiB,GAAG7B,EAAE,CAACkC,GAAG,CAACL,iBAAiB,EAAE,CAAC,CAAC,CAAC;IACjDA,iBAAiB,GAAG7B,EAAE,CAACY,UAAU,CAACiB,iBAAiB,EAAE,CAAC,CAAC,CAAC;IAExD,OAAOA,iBAAiB;;EAE5B,OAAOX,GAAG,CAACY,KAAK,CAAC,CAACJ,WAAW,EAAEE,UAAU,EAAE,CAAC,CAAC,EAAE,CAACP,IAAI,EAAEA,IAAI,EAAE,CAAC,CAAC,CAAC;AACnE;AAtBAJ,OAAA,CAAAP,UAAA,GAAAA,UAAA","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}